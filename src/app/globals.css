@import "tailwindcss";
@import "tw-animate-css";
@plugin "@tailwindcss/typography";
@import "katex/dist/katex.min.css";

@custom-variant dark (&:is(.dark *));

@theme {
  --font-sans:
    var(--font-sans), ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
    "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";

  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));

  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));

  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));

  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));

  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));

  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));

  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));

  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));

  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);

  --animate-accordion-down: accordion-down 0.2s ease-out;
  --animate-accordion-up: accordion-up 0.2s ease-out;
  --animate-collapsible-down: collapsible-down 0.3s ease-out;
  --animate-collapsible-up: collapsible-up 0.3s ease-out;

  @keyframes accordion-down {
    from {
      height: 0;
    }
    to {
      height: var(--radix-accordion-content-height);
    }
  }
  @keyframes accordion-up {
    from {
      height: var(--radix-accordion-content-height);
    }
    to {
      height: 0;
    }
  }
  @keyframes collapsible-down {
    from {
      height: 0;
      opacity: 0;
    }
    to {
      height: var(--radix-collapsible-content-height);
      opacity: 1;
    }
  }
  @keyframes collapsible-up {
    from {
      height: var(--radix-collapsible-content-height);
      opacity: 1;
    }
    to {
      height: 0;
      opacity: 0;
    }
  }
}

/*
  The default border color has changed to `currentcolor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }

  /* 平滑滚动 */
  html {
    scroll-behavior: smooth;
  }
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 210 11.1% 3.53%;

    --card: 0 0% 100%;
    --card-foreground: 210 11.1% 3.53%;

    --popover: 0 0% 100%;
    --popover-foreground: 210 11.1% 3.53%;

    --primary: 0 0% 9%;
    --primary-foreground: 0 0% 98%;

    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 9%;

    --muted: 0 0% 96.1%;
    --muted-foreground: 0 0% 45.1%;

    --accent: 0 0% 96.1%;
    --accent-foreground: 0 0% 9%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;

    --border: 0 0% 89.8%;
    --input: 0 0% 89.8%;
    --ring: 0 0% 3.9%;

    --radius: 0.5rem;
  }

  .dark {
    --background: 210 11.1% 3.53%;
    --foreground: 0 0% 98%;

    --card: 210 11.1% 3.53%;
    --card-foreground: 0 0% 98%;

    --popover: 210 11.1% 3.53%;
    --popover-foreground: 0 0% 98%;

    --primary: 0 0% 98%;
    --primary-foreground: 0 0% 9%;

    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;

    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;

    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;

    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 83.1%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* code styling */
h3 code {
  @apply text-lg! md:text-xl!;
}

pre {
  @apply overflow-x-auto rounded-lg px-0! py-4;
}

pre [data-line] {
  @apply px-4;
}

code {
  @apply text-sm leading-loose! md:text-base;
}

pre > code {
  counter-reset: line;
}

code[data-theme*="light"],
code[data-theme*="light"] span {
  color: var(--shiki-light);
  background-color: var(--shiki-light-bg);
}

@media (prefers-color-scheme: dark) {
  code[data-theme*="dark"],
  code[data-theme*="dark"] span {
    color: var(--shiki-dark);
    background-color: var(--shiki-dark-bg);
  }
}

code[data-line-numbers] {
  counter-reset: line;
}

code[data-line-numbers] > [data-line]::before {
  counter-increment: line;
  content: counter(line);
  @apply mr-4 inline-block w-4 text-right text-gray-500;
}

code {
  counter-reset: line;
}

code > [data-line]::before {
  counter-increment: line;
  content: counter(line);

  /* Other styling */
  display: inline-block;
  width: 1rem;
  margin-right: 2rem;
  text-align: right;
  color: gray;
}

code[data-line-numbers-max-digits="2"] > [data-line]::before {
  width: 2rem;
}

code[data-line-numbers-max-digits="3"] > [data-line]::before {
  width: 3rem;
}

/* Notion-style scrollbar for TOC */
.scrollbar-thin {
  scrollbar-width: thin;
  scrollbar-color: hsl(var(--border)) transparent;
}

.scrollbar-thin::-webkit-scrollbar {
  width: 6px;
}

.scrollbar-thin::-webkit-scrollbar-track {
  background: transparent;
}

.scrollbar-thin::-webkit-scrollbar-thumb {
  background-color: hsl(var(--border));
  border-radius: 3px;
  transition: background-color 0.2s ease;
}

.scrollbar-thin::-webkit-scrollbar-thumb:hover {
  background-color: hsl(var(--muted-foreground) / 0.5);
}

.dark .scrollbar-thin::-webkit-scrollbar-thumb {
  background-color: hsl(var(--border) / 0.6);
}

.dark .scrollbar-thin::-webkit-scrollbar-thumb:hover {
  background-color: hsl(var(--muted-foreground) / 0.4);
}

@layer utilities {
  .animate-slide-fade {
    animation: slide-fade 320ms ease-in-out;
  }
  .animate-slide-left {
    animation: slide-left 260ms ease-in-out;
  }
  .animate-slide-right {
    animation: slide-right 260ms ease-in-out;
  }
}

@keyframes slide-fade {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slide-left {
  from {
    opacity: 0;
    transform: translateX(24px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ======================== */
/* Markdown 服务端渲染样式  */
/* ======================== */

/* Prose 基础样式 */
.prose {
  @apply max-w-none;
}

.prose pre {
  @apply rounded-lg border border-border bg-muted p-4 overflow-x-auto;
  background-color: var(--shiki-light-bg, #f8f8f8);
}

.dark .prose pre {
  background-color: var(--shiki-dark-bg, #1e1e1e);
}

/* 代码块内代码 */
.prose code {
  @apply bg-muted px-1.5 py-0.5 rounded text-sm;
}

.prose pre code {
  @apply bg-transparent px-0 py-0;
}

/* 数学公式样式 */
.prose .katex-display {
  @apply overflow-x-auto py-4;
}

.prose .katex {
  @apply text-base;
}

/* 目录样式 */
.prose-toc {
  @apply list-none pl-0 space-y-1;
}

.prose-toc li {
  @apply list-none;
}

.prose-toc a {
  @apply text-muted-foreground hover:text-foreground transition-colors;
  @apply text-sm;
}

.toc-level-1 {
  @apply pl-0;
}

.toc-level-2 {
  @apply pl-4;
}

.toc-level-3 {
  @apply pl-8;
}

.toc-level-4 {
  @apply pl-12;
}

.toc-level-5 {
  @apply pl-16;
}

.toc-level-6 {
  @apply pl-20;
}

/* GitHub 风格警告块 */
.prose blockquote[data-type="note"] {
  @apply border-l-blue-500 bg-blue-50 dark:bg-blue-950;
}

.prose blockquote[data-type="warning"] {
  @apply border-l-yellow-500 bg-yellow-50 dark:bg-yellow-950;
}

.prose blockquote[data-type="danger"] {
  @apply border-l-red-500 bg-red-50 dark:bg-red-950;
}

/* 表格样式 */
.prose table {
  @apply w-full border-collapse;
}

.prose th {
  @apply bg-muted px-4 py-2 text-left font-semibold;
}

.prose td {
  @apply border border-border px-4 py-2;
}

.prose tr:nth-child(even) {
  @apply bg-muted/50;
}

/* 标题 ID 锚点 */
.prose h1,
.prose h2,
.prose h3,
.prose h4,
.prose h5,
.prose h6 {
  @apply scroll-mt-20; /* 与导航栏高度一致 */
}

.prose h2 a,
.prose h3 a,
.prose h4 a {
  @apply no-underline;
}

@keyframes slide-right {
  from {
    opacity: 0;
    transform: translateX(-24px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ======================== */
/* Markdown 服务端渲染样式  */
/* ======================== */
